# AI YALY Telegram Bot

Это умный Telegram-бот, который умеет отвечать на вопросы, создавать изображения, распознавать содержимое картинок и хранить историю запросов. Написан на Python, использует API OpenAI (через OpenRouter), Pollinations для генерации изображений и SQLite для сохранения запросов.

## Возможности

- **Ответы на вопросы**: Отвечает на любые вопросы с помощью языковой модели.
- **Генерация изображений**: Создаёт картинки по текстовым описаниям.
- **Распознавание изображений**: Описывает, что изображено на загруженных фотках.
- **Анализ намерений**: Сам понимает, хочет ли пользователь задать вопрос, сгенерировать картинку или описать изображение.
- **История запросов**: Можно скачать историю запросов в виде `.txt` файла.
- **Интерактивные ответы**: Добавляет кнопки для перегенерации ответа или запроса подробного объяснения.
- **Форматирование в HTML**: Ответы красиво оформлены в HTML для Telegram.

## Требования

- Python 3.8 или новее
- Токен Telegram-бота (получите у [BotFather](https://t.me/BotFather))
- API-ключ OpenAI (через [OpenRouter](https://openrouter.ai/))
- Система с установленным `pip` для установки зависимостей

## Установка

1. **Склонируйте репозиторий**:
   ```bash
   git clone https://github.com/your-username/AI_YALY_TG_BOT.git
   cd AI_YALY_TG_BOT
   ```

2. **Создайте виртуальное окружение** (рекомендуется):
   ```bash
   python -m venv .venv
   source .venv/bin/activate  # На Windows: .venv\Scripts\activate
   ```

3. **Установите зависимости**:
   ```bash
   pip install -r requirements.txt
   ```

   Убедитесь, что файл `requirements.txt` содержит:
   ```
   aiofiles==24.1.0
   aiogram==3.20.0.post0
   aiohappyeyeballs==2.6.1
   aiohttp==3.11.18
   aiosignal==1.3.2
   annotated-types==0.7.0
   anyio==4.9.0
   attrs==25.3.0
   audioop-lts==0.2.1
   Brotli==1.1.0
   certifi==2025.4.26
   charset-normalizer==3.4.2
   distro==1.9.0
   frozenlist==1.6.0
   h11==0.16.0
   httpcore==1.0.9
   httpx==0.28.1
   idna==3.10
   jiter==0.9.0
   magic-filter==1.0.12
   multidict==6.4.3
   nest-asyncio==1.6.0
   openai==1.78.1
   packaging==25.0
   pillow==11.2.1
   pollinations==4.5.1
   propcache==0.3.1
   pycryptodome==3.22.0
   pydantic==2.11.4
   pydantic_core==2.33.2
   pydub==0.25.1
   requests==2.32.3
   setuptools==69.5.1
   six==1.17.0
   sniffio==1.3.1
   SpeechRecognition==3.14.3
   standard-aifc==3.13.0
   standard-chunk==3.13.0
   tqdm==4.67.1
   typing-inspection==0.4.0
   typing_extensions==4.13.2
   urllib3==2.4.0
   whisper==1.1.10
   yarl==1.20.0

   ```

4. **Настройте API-ключи**:
   - Создайте папку `api_keys` в корне проекта.
   - Создайте файл `api_keys/api_keys.json` со следующей структурой:
     ```json
     {
       "telegram_api_token": "ВАШ_ТЕЛЕГРАМ_ТОКЕН",
       "openai_api_key": "ВАШ_OPENROUTER_API_КЛЮЧ"
     }
     ```

5. **Запустите бота**:
   ```bash
   python app/main_app.py
   ```

## Использование

Когда бот запущен, общайтесь с ним через Telegram:

- **Запуск бота**: Отправьте `/start`, чтобы получить приветственное сообщение.
- **Список команд**: Отправьте `/help`, чтобы узнать, что умеет бот.
- **Задать вопрос**: Напишите вопрос (например, "Что такое Python?") или начните с "ask" (например, "ask Что такое Python?").
- **Создать картинку**: Напишите описание (например, "generate Закат над горами") или любой текст, который бот распознает как запрос на генерацию.
- **Описать изображение**: Пришлите фото, и бот расскажет, что на нём.
- **История запросов**: Отправьте `/history`, чтобы скачать `.txt` файл с историей ваших запросов.

**Пример общения**:
```
Пользователь: /start
Бот: Привет, [Ваше Имя]! Я бот, который отвечает на вопросы, генерирует изображения и распознаёт их содержимое. Напиши /help для списка команд.

Пользователь: Что такое столица Франции?
Бот: Столица Франции — Париж. [Кнопки: Перегенерировать, Объяснить подробнее]

Пользователь: Нарисуй Милого котёнка
Бот: [Присылает картинку с милым котёнком]

Пользователь: /history
Бот: [Присылает .txt файл с историей запросов]
```

## Структура проекта

```
AI_YALY_TG_BOT/
├── app/
│   ├── ai_answer_mdl.py          # Отвечает за ответы на вопросы через OpenAI
│   ├── main_app.py              # Основная логика бота и обработчики Telegram
│   ├── img_gen_mdl.py           # Генерация изображений с помощью Pollinations
│   ├── img_recgn_mdl.py         # Распознавание содержимого картинок через OpenAI
│   ├── intent_analyzer_mdl.py   # Определяет намерения пользователя
│   ├── response_formatter_mdl.py # Форматирует ответы в HTML
│   ├── database_mdl.py          # Управляет базой данных SQLite
├── api_keys/
│   ├── api_keys.json            # Хранит API-ключи (не добавляйте в git)
├── requirements.txt             # Зависимости Python
├── README.md                    # Этот файл
```

## База данных

Бот использует SQLite для хранения запросов в файле `user_queries.db`. Схема таблицы:
- `id`: Автоинкрементный первичный ключ
- `user_id`: ID пользователя в Telegram
- `chat_id`: ID чата в Telegram
- `message_id`: ID сообщения
- `query`: Текст запроса
- `timestamp`: Время запроса

## Логирование

Бот пишет логи о всех важных событиях (например, обработка запросов, ошибки) в консоль. Логи помогают отлаживать проблемы и следить за работой бота.

## Лицензия

[MIT License](LICENSE) — используйте, модифицируйте и распространяйте код свободно, но указывайте авторство.

## Контакты

Если есть вопросы или предложения, пишите в [issues](https://github.com/your-username/AI_YALY_TG_BOT/issues) или свяжитесь с разработчиком через Telegram: @ReVoLuTiOn137.
